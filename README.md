# Определение положения мяча относительно сетки

Приложение для определения, находится ли мяч за сеткой или перед ней на изображениях и видео.

## Возможности

- ✅ Детекция мяча с помощью YOLO
- ✅ Обнаружение сетки тремя методами (Hough, Contour, Color)
- ✅ Определение положения мяча относительно сетки
- ✅ Графический интерфейс (GUI)
- ✅ Интерфейс командной строки (CLI)
- ✅ Обработка изображений и видео
- ✅ Визуализация результатов

## Установка

### 1. Клонирование репозитория (если нужно)

```bash
cd /home/sergii/PycharmProjects/Net
```

### 2. Создание виртуального окружения

```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

## Использование

### Графический интерфейс (GUI)

Запустите приложение с графическим интерфейсом:

```bash
python main.py
```

**Инструкция:**
1. Нажмите "Загрузить изображение" или "Загрузить видео"
2. Выберите модель YOLO (по умолчанию yolov8n.pt, или укажите свою обученную модель)
3. Выберите метод детекции сетки (hough, contour, color)
4. Настройте порог уверенности с помощью слайдера
5. Нажмите "Анализировать"

### Командная строка (CLI)

#### Обработка изображения

```bash
python cli.py path/to/image.jpg
```

С дополнительными параметрами:

```bash
python cli.py path/to/image.jpg \
    --model yolov8s.pt \
    --confidence 0.6 \
    --net-method hough \
    --output result.jpg
```

#### Обработка видео

```bash
python cli.py path/to/video.mp4 --video
```

С дополнительными параметрами:

```bash
python cli.py path/to/video.mp4 --video \
    --model path/to/custom_model.pt \
    --confidence 0.5 \
    --net-method contour \
    --output result.mp4
```

### Параметры CLI

- `input` - путь к изображению или видео (обязательный)
- `-m, --model` - путь к модели YOLO (по умолчанию: yolov8n.pt)
- `-c, --confidence` - порог уверенности детекции (0-1, по умолчанию: 0.5)
- `-n, --net-method` - метод детекции сетки: hough/contour/color (по умолчанию: hough)
- `-o, --output` - путь для сохранения результата
- `-v, --video` - флаг обработки видео

## Структура проекта

```
Net/
├── ball_detector.py       # Модуль детекции мяча с YOLO
├── net_detector.py        # Модуль детекции сетки
├── position_analyzer.py   # Модуль анализа положения мяча
├── main.py               # GUI приложение
├── cli.py                # CLI приложение
├── requirements.txt      # Зависимости
└── README.md            # Документация
```

## Работа с собственными датасетами YOLO

### Если у вас уже есть обученная модель

Просто укажите путь к вашей модели:

```bash
python cli.py image.jpg --model path/to/your_model.pt
```

Или выберите "Своя модель..." в GUI.

### Если нужно обучить модель на ваших датасетах

1. Подготовьте датасет в формате YOLO:
```
dataset/
├── images/
│   ├── train/
│   ├── val/
│   └── test/
└── labels/
    ├── train/
    ├── val/
    └── test/
```

2. Создайте файл конфигурации `data.yaml`:
```yaml
path: /path/to/dataset
train: images/train
val: images/val
test: images/test

nc: 1  # number of classes
names: ['ball']  # class names
```

3. Обучите модель:
```python
from ultralytics import YOLO

# Загрузите базовую модель
model = YOLO('yolov8n.pt')

# Обучите на своих данных
results = model.train(
    data='data.yaml',
    epochs=100,
    imgsz=640,
    batch=16,
    name='ball_detector'
)

# Модель сохранится в runs/detect/ball_detector/weights/best.pt
```

4. Используйте обученную модель:
```bash
python cli.py image.jpg --model runs/detect/ball_detector/weights/best.pt
```

## Методы детекции сетки

### 1. Hough (по умолчанию)
- Использует преобразование Хафа для поиска прямых линий
- Хорошо работает с четкими контрастными сетками
- Рекомендуется для большинства случаев

### 2. Contour
- Использует поиск контуров
- Хорошо работает, когда сетка четко выделяется на фоне
- Подходит для сеток с явными границами

### 3. Color
- Использует цветовую сегментацию (по умолчанию ищет белый цвет)
- Лучше всего для белых сеток на темном фоне
- Можно настроить диапазон цветов в коде

## Принцип работы

1. **Детекция мяча**: используется модель YOLO для обнаружения мяча на изображении
2. **Детекция сетки**: один из трех методов компьютерного зрения находит вертикальную линию сетки
3. **Анализ положения** (для камеры за воротами):
   - **Размер мяча** (основной критерий): мяч дальше (за сеткой) выглядит меньше
   - **Y-координата**: мячи за сеткой обычно в верхней части кадра
   - **Окклюзия**: анализ перекрытия мяча сеткой
   - Вычисляется уверенность в определении

**Примечание:** Приложение оптимизировано для съемки с камеры, расположенной **за футбольными воротами**. См. `LOGIC_EXPLAINED.md` для деталей.

## Визуализация результатов

- **Зеленый прямоугольник** - мяч перед сеткой
- **Красный прямоугольник** - мяч за сеткой
- **Голубая линия** - обнаруженная сетка
- **Текст** - положение и уверенность

## Примеры использования

### Пример 1: Быстрый анализ изображения

```bash
python cli.py photo.jpg
```

### Пример 2: Анализ с настройками

```bash
python cli.py volleyball_game.jpg \
    --model my_volleyball_detector.pt \
    --confidence 0.7 \
    --net-method color
```

### Пример 3: Обработка видео матча

```bash
python cli.py match.mp4 --video \
    --model best_ball_model.pt \
    --confidence 0.6 \
    --output analyzed_match.mp4
```

### Пример 4: GUI для интерактивной работы

```bash
python main.py
# Загружайте изображения/видео и экспериментируйте с параметрами в реальном времени
```

## Требования

- Python 3.8+
- CUDA (опционально, для ускорения на GPU)
- Веб-камера (опционально, для работы в реальном времени)

## Устранение неполадок

### Модель не загружается
- Убедитесь, что у вас установлен PyTorch
- Проверьте путь к модели
- Для первого запуска YOLOv8 загрузит предобученную модель автоматически

### Сетка не обнаруживается
- Попробуйте разные методы детекции (hough, contour, color)
- Убедитесь, что сетка четко видна на изображении
- Возможно, нужно настроить параметры детекции в `net_detector.py`

### Низкая производительность на видео
- Используйте более легкую модель YOLO (yolov8n.pt вместо yolov8x.pt)
- Уменьшите разрешение видео
- Используйте GPU, если доступен

## Лицензия

MIT

## Автор

Создано для анализа положения мяча в спортивных играх (волейбол, теннис и др.)
